name: Create release

on:
  push:
    paths-ignore:
      - 'setup.py'
    branches:
      - prod
      - generate-release

jobs:
  generate_release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python 3.9
        uses: actions/setup-python@v3
        with:
          python-version: 3.9

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
      
      - name: Build BIPy
        run: |
          pyinstaller --noconfirm --onedir --windowed --icon "./src/GUI/assets/icone.ico" --name "BIPy" --add-data "./src:src/"  "./src/main.py"
          cd dist
          zip -r BIPy.zip BIPy

      - name: Create realese
        env:
          GITHUB_TOKEN: ${{ secrets.BIPy_TOKEN }}
        run: |
          gh release create v${{ github.ref }} -t "Release v${{ github.ref }}" -F ./dist/BIPy.zip

